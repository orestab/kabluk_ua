<!doctype html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>KABLUK | –ú–û–á –ó–ê–ú–û–í–õ–ï–ù–ù–Ø</title>
    <style>
      /* –õ–æ–∫–∞–ª—å–Ω—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –∑–∞–º–æ–≤–ª–µ–Ω—å */
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background-color: #fff;
      }

      .page-content {
        padding-top: 50px;
        min-height: 80vh;
      }

      .back-nav {
        max-width: 800px;
        margin: 0 auto 20px;
        padding: 0 20px;
      }

      .back-btn {
        text-decoration: none;
        color: #000;
        font-size: 12px;
        font-weight: bold;
        letter-spacing: 2px;
        text-transform: uppercase;
        transition: 0.3s;
        display: inline-block;
      }

      .back-btn:hover {
        opacity: 0.6;
        transform: translateX(-5px);
      }

      .page-title {
        text-align: center;
        letter-spacing: 5px;
        text-transform: uppercase;
        margin-bottom: 40px;
        font-size: 24px;
      }

      .orders-container {
        max-width: 800px;
        margin: 0 auto 50px;
        padding: 0 20px;
      }

      /* –ö–∞—Ä—Ç–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è */
      .order-card {
        border: 1px solid #000;
        padding: 25px;
        margin-bottom: 30px;
        display: flex;
        flex-direction: column;
        gap: 15px;
        position: relative;
      }

      .order-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #eee;
        padding-bottom: 15px;
      }

      .order-number {
        font-weight: bold;
        font-size: 18px;
      }

      .order-date {
        color: #888;
        font-size: 14px;
      }

      .order-items {
        font-size: 16px;
        line-height: 1.5;
      }

      .order-total {
        font-weight: bold;
        font-size: 16px;
        margin-top: 5px;
      }

      .order-status {
        display: inline-block;
        padding: 4px 8px;
        background: #f4f4f4;
        font-size: 12px;
        letter-spacing: 1px;
        text-transform: uppercase;
      }

      /* –ö–Ω–æ–ø–∫–∞ –≤—ñ–¥–º—ñ–Ω–∏—Ç–∏ */
      .cancel-order-btn {
        align-self: flex-start;
        background: #fff;
        border: 1px solid #ff0000;
        color: #ff0000;
        padding: 10px 20px;
        cursor: pointer;
        font-size: 11px;
        font-weight: bold;
        letter-spacing: 1px;
        text-transform: uppercase;
        transition: 0.3s;
      }

      .cancel-order-btn:hover {
        background: #ff0000;
        color: #fff;
      }

      /* –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ—Ä–æ–∂–Ω—ñ–π —Å–ø–∏—Å–æ–∫ */
      .no-orders {
        text-align: center;
        padding: 100px 20px;
      }

      .no-orders p {
        font-size: 14px;
        letter-spacing: 2px;
        color: #888;
        margin-bottom: 20px;
      }
    </style>
  </head>
  <body>
    <div class="overlay" id="overlay"></div>

    <main class="page-content">
      <div class="back-nav">
        <a href="index.html" class="back-btn">‚Üê –ù–∞–∑–∞–¥ –¥–æ –º–∞–≥–∞–∑–∏–Ω—É</a>
      </div>

      <h2 class="page-title">–ú–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>

      <div class="orders-container" id="orders-list"></div>
    </main>

    <script type="module" src="script.js"></script>
    <script>
      const ordersList = document.getElementById("orders-list");

      // –¢–≤–æ—ó –¥–∞–Ω—ñ Telegram
      const TELEGRAM_BOT_TOKEN =
        "8538424384:AAGGmG6G-zKTNJ1lwzfSrqygTv1i5VH6Jro";
      const TELEGRAM_CHAT_ID = "5151112559";

      function renderOrders() {
        const orders = JSON.parse(localStorage.getItem("userOrders")) || [];

        if (orders.length === 0) {
          ordersList.innerHTML = `
                <div class="no-orders">
                    <p>–£ –í–ê–° –ü–û–ö–ò –ù–ï–ú–ê–Ñ –ó–ê–ú–û–í–õ–ï–ù–¨</p>
                    <a href="catalog.html" class="back-btn" style="border: 1px solid #000; padding: 10px 20px;">–ü–ï–†–ï–ô–¢–ò –î–û –ö–ê–¢–ê–õ–û–ì–£</a>
                </div>
            `;
          return;
        }

        ordersList.innerHTML = orders
          .map(
            (order) => `
                <div class="order-card" id="order-${order.id}">
                    <div class="order-info">
                        <div>
                            <div class="order-number">‚Ññ${order.id}</div>
                            <div class="order-date">${order.date}</div>
                        </div>
                        <div class="order-status">–í –æ–±—Ä–æ–±—Ü—ñ</div>
                    </div>
                    <div class="order-items">
                        <strong>–¢–æ–≤–∞—Ä–∏:</strong> ${Array.isArray(order.items) ? order.items.join(", ") : order.items}
                    </div>
                    <div class="order-total">–°–£–ú–ê: ${order.total} –ì–†–ù</div>
                    <button class="cancel-order-btn" onclick="cancelOrder('${order.id}', '${order.total}')">–í–Ü–î–ú–Ü–ù–ò–¢–ò –ó–ê–ú–û–í–õ–ï–ù–ù–Ø</button>
                </div>
            `,
          )
          .reverse()
          .join("");
      }

      // –§–£–ù–ö–¶–Ü–Ø –í–Ü–î–ú–Ü–ù–ò –ó–Ü –°–ü–û–í–Ü–©–ï–ù–ù–Ø–ú
      window.cancelOrder = async function (id, total) {
        if (confirm("–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ —Å–∫–∞—Å—É–≤–∞—Ç–∏ —Ü–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è?")) {
          let orders = JSON.parse(localStorage.getItem("userOrders")) || [];

          // –ó–Ω–∞—Ö–æ–¥–∏–º–æ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –¥–ª—è —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º
          const orderToCancel = orders.find((o) => String(o.id) === String(id));

          if (orderToCancel) {
            // –í—ñ–¥–ø—Ä–∞–≤–∫–∞ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è –≤ Telegram
            await sendCancellationTelegram(orderToCancel);

            // –í–∏–¥–∞–ª—è—î–º–æ –∑ –ø–∞–º'—è—Ç—ñ
            orders = orders.filter((o) => String(o.id) !== String(id));
            localStorage.setItem("userOrders", JSON.stringify(orders));

            alert("–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —Å–∫–∞—Å–æ–≤–∞–Ω–æ. –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç—Ä–∏–º–∞–≤ —Å–ø–æ–≤—ñ—â–µ–Ω–Ω—è.");
            renderOrders();
          }
        }
      };

      // –§—É–Ω–∫—Ü—ñ—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –≤ Telegram
      async function sendCancellationTelegram(order) {
        const message = `
‚ùå **–ó–ê–ú–û–í–õ–ï–ù–ù–Ø –°–ö–ê–°–û–í–ê–ù–û –ö–õ–Ü–Ñ–ù–¢–û–ú** ‚ùå
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üî¢ **–ù–æ–º–µ—Ä:** ‚Ññ${order.id}
üìÖ **–î–∞—Ç–∞:** ${order.date}
üí∞ **–°—É–º–∞ –±—É–ª–∞:** ${order.total} –≥—Ä–Ω
üõçÔ∏è **–¢–æ–≤–∞—Ä–∏:** ${Array.isArray(order.items) ? order.items.join(", ") : order.items}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‚ö†Ô∏è *–ö–ª—ñ—î–Ω—Ç –Ω–∞—Ç–∏—Å–Ω—É–≤ –∫–Ω–æ–ø–∫—É "–í—ñ–¥–º—ñ–Ω–∏—Ç–∏" –≤ –æ—Å–æ–±–∏—Å—Ç–æ–º—É –∫–∞–±—ñ–Ω–µ—Ç—ñ.*
`;

        const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;

        try {
          await fetch(url, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              chat_id: TELEGRAM_CHAT_ID,
              text: message,
              parse_mode: "Markdown",
            }),
          });
        } catch (err) {
          console.error("–ü–æ–º–∏–ª–∫–∞ Telegram:", err);
        }
      }

      document.addEventListener("DOMContentLoaded", renderOrders);
    </script>
  </body>
</html>
